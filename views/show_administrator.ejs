<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>ショーシフト管理システム</title>
    </head>
    <body>
        
        <script src = "../public/js/make_header.js" type="text/javascript"></script>
        <main>
            
            <div class="title">
                <h2><%= show_name %> 管理ページ</h2>
            </div>
            <div>
                <% if(show_id != 1){ %>
                    <p><a href= <%= "http://localhost:3000/show-home?show_id=" + show_id %>> 公開ページはこちらから</a></p>
                <% } %>
            </div>
            <div class="main">
                <div id="report">
                    <h3>報告一覧</h3>
                    <!-- 【半分画面遷移】承認と修正ができる、表形式で出せるとよい、その他で入力されたものもここに表示 -->
                    <table id="notice-list" border="1">
                        <thead>
                            <!-- ショーの日時と種類だけ表示 -->
                            <tr>
                                <th>No.</th>
                                <th>種類</th>
                                <th>ショー日時</th>
                                <th>詳細</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% notices.forEach(notice => { %>
                                <tr id="test">
                                    <td><%= notice.notice_id %></td>
                                    <td><%= notice.type_of_message %></td>
                                    <td><%= notice.day_and_time.toLocaleString()%></td>
                                </th>
                                    <td><button id=<%= "open" + notice.notice_id %> onClick="show_detail(this)"> 詳細表示</td>
                                </tr>
                                <tr id= <%= "shift-detail-" + notice.notice_id %> style="display : none;">
                                    <td></td>
                                    <td>シフト</td>
                                    <td>
                                        <% console.log(rolls) %>
                                        <% if(notice.report_id != 1){ %>
                                            <% for(var roll in notice.shift){ %>
                                                <% console.log(rolls) %>
                                                <% rolls.forEach(rs => { %>
                                                    <% if(parseInt(roll) == rs.roll_id){ %>
                                                        <% all_cast.forEach(ac => { %>
                                                            <% if(parseInt(notice.shift[roll]) == ac.entertainer_id){ %>
                                                                <%= rs.roll_name %> : <%= ac.entertainer_name %> <br>
                                                            <% } %>
                                                        <% }); %>
                                                    <% } %>
                                                <% }); %>
                                            <% } %>
                                        <% } %>
                                        
                                    </td>
                                </tr>
                                <tr id= <%= "other-detail-" + notice.notice_id %> style="display : none;">
                                    <td></td>
                                    <td>そのほか入力</td>
                                    <td>
                                        <%= notice.content %>
                                    </td>
                                </tr>
                                <tr id = <%= "operate-" + notice.notice_id %> style="display : none;">
                                    <% if(show_id != 1){ %>
                                        <td><a href =
                                            <%= "location.href='http://localhost:3000/show-admin/report-detail?show_id=" + show_id + "&report_id=" + notice.report_id +  "'"%> >
                                            報告編集・公開 </a></td>
                                    <% }else{ %>
                                        <td><form action= <%= "http://localhost:3000/accept-request?notice_id=" + notice.notice_id %> method="get">
                                                <button type="submit">申請承認</td>
                                    <% } %>

                                    <td><a href =
                                            <%= "location.href='http://localhost:3000/show-admin/delete-notice?show_id=" + show_id + "&notice_id=" + notice.notice_id + "&report_id=" + notice.reoprt_id + "'"%> >
                                            削除（復元不可） </a></td>
                                    <td><button id=<%= "close-" + notice.notice_id %> onClick="close_detail(this)"> 閉じる</td>
                                </tr>
                            <% }); %>
                            <!-- 詳細表示 -->
                            <script type="text/javascript">
                                function show_detail(ele){
                                    console.log(document.getElementById("test").style.display)
                                    let id = ele.id.slice(4);
                                    document.getElementById("shift-detail-" + id).style.display = "";
                                    document.getElementById("other-detail-" + id).style.display = "";
                                    document.getElementById("operate-" + id).style.display = "";
                                };
                                function close_detail(ele){
                                    let id = ele.id.slice(6);
                                    console.log(id)
                                    document.getElementById("shift-detail-" + id).style.display = "none";
                                    document.getElementById("other-detail-" + id).style.display = "none";
                                    document.getElementById("operate-" + id).style.display = "none";
                                };
                            </script>
                        </tbody>
                    </table>

                </div>
                
                <div id="insert-shift">
                    <a href= <%="http://localhost:3000/show-report?show_id=" + show_id %> >
                        <h3>シフト報告（報告後、承認作業が必要です。）</h3>
                    </a>
                    <!-- 一般入力用のページに飛ばして、ログイン判定で即公開みたいなことする？ 
                    -->
                </div>

                <div id="shift-edit">
                    <a href=<%="http://localhost:3000/show?show_id=" + show_id %>>
                        <h3>公開済みシフト編集</h3>
                    </a>
                    <!-- 
                    【画面遷移】
                    ショーページのホーム画面に飛ばして、ログイン判定、renderを分ける
                    日時クリックー＞シフト公開と同じフォーマットで編集→変更確定
                    -->
                </div>

                <div id="new-position">
                    <h3>
                        <a href=<%= "http://localhost:3000/show-admin/create-position?show_id=" + show_id %>>新ポジション登録</a>
                    </h3>
                    <!-- 
                    【画面遷移】ポジション追加
                    -->
                </div>

                <div id="announce">
                    <h3>
                        <a href=<%= "http://localhost:3000/show-admin/create-position?show_id=" + show_id %>>新ポジション登録</a>
                    </h3>
                    <!-- 更新のお知らせなど-->
                </div>


            </div>
        </main>
   </body>
</html>